---
title: "Son_Hali"
output:
  html_document:
    self_contained: true
    embed_resources: true
---

## Veri MadenciliÄŸi

### AZIOSB AtÄ±k Su MiktarÄ± Analizi

#### Ä°Ã‡Ä°NDEKÄ°LER

1.  Verilerin RSTUDIO'YA YÃœKLENMESÄ°

    1.1. KullanÄ±lacak KÃ¼tÃ¼phanelerin Proje DosyasÄ±na TanÄ±tÄ±lmasÄ±

    1.2. CSV DosyalarÄ±nÄ± XLXS TÃ¼rÃ¼ne DÃ¶nÃ¼ÅŸtÃ¼rme

    1.3. XLXS TÃ¼rÃ¼ne DÃ¶nÃ¼ÅŸtÃ¼rÃ¼len Veri Setini RSTUDIO'ya YÃ¼kleme

    1.4. Veri Temizleme ve HazÄ±rlama

2.  Veri GÃ¶rselleÅŸtirme ve Analizi

    2.1. TanÄ±mlayÄ±cÄ± Veri Analizi Ä°statistikleri

    -   GÃ¼nlÃ¼k Ortalama AtÄ±k MiktarÄ± GrafiÄŸi

    -   HaftaiÃ§i ve Hafta sonu Ortalama AtÄ±k MiktarÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±

    -   Saatlik analiz (gÃ¼nÃ¼n hangi saatinde atÄ±k miktarÄ± daha yÃ¼ksek)

    -   Aylar ArasÄ± AtÄ±k MiktarÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±

    -   HaftanÄ±n GÃ¼nlerine GÃ¶re AtÄ±k MiktarÄ± Analizi

    -   HaftanÄ±n GÃ¼nlerine GÃ¶re IsÄ± HaritasÄ±

#### Verileri RStudio'ya YÃ¼kleme

#### 1.1. KullanÄ±lacak KÃ¼tÃ¼phanelerin Proje DosyasÄ±na TanÄ±tÄ±lmasÄ±

```{r}
# YÃ¶ntem 1: Temel sessiz yÃ¼kleme
suppressPackageStartupMessages({
  if (!require("readr", quietly = TRUE)) install.packages("readr")
  if (!require("readxl", quietly = TRUE)) install.packages("readxl")
  if (!require("writexl", quietly = TRUE)) install.packages("writexl")
  if (!require("dplyr", quietly = TRUE)) install.packages("dplyr")
  if (!require("ggplot2", quietly = TRUE)) install.packages("ggplot2")
  if (!require("lubridate", quietly = TRUE)) install.packages("lubridate")
  if (!require("forecast", quietly = TRUE)) install.packages("forecast")
  if (!require("zoo", quietly = TRUE)) install.packages("zoo")
  if (!require("scales", quietly = TRUE)) install.packages("scales")
  if (!require("purrr", quietly = TRUE)) install.packages("purrr")
  if (!require("stringr", quietly = TRUE)) install.packages("stringr")
  if (!require("prophet", quietly = TRUE)) install.packages("prophet")
  if (!require("tseries", quietly = TRUE)) install.packages("tseries")
  
  library(readr)
  library(readxl)
  library(writexl)
  library(dplyr)
  library(ggplot2)
  library(lubridate)
  library(forecast)
  library(zoo)
  library(scales)
  library(purrr)
  library(stringr)
  library(tidyr)
  library(prophet)
  library(tseries)
})

# YÃ¶ntem 2: Tamamen sessiz yÃ¼kleme (hiÃ§bir mesaj yok)
invisible({
  capture.output({
    suppressPackageStartupMessages({
      suppressWarnings({
        
        # Gerekli paketler listesi
        paketler <- c("readr", "readxl", "writexl", "dplyr", "ggplot2", 
                     "lubridate", "forecast", "zoo", "scales", "purrr", 
                     "stringr", "tidyr", "prophet", "tseries")
        
        # Paketleri kontrol et ve yÃ¼kle
        for(paket in paketler) {
          if (!require(paket, character.only = TRUE, quietly = TRUE)) {
            install.packages(paket, quiet = TRUE)
            library(paket, character.only = TRUE, quietly = TRUE)
          }
        }
      })
    })
  })
})

cat("KÃ¼tÃ¼phaneler hazÄ±r.\n")
```

#### 1.2. CSV DosyalarÄ±nÄ± XLXS TÃ¼rÃ¼ne DÃ¶nÃ¼ÅŸtÃ¼rme

```{r}

# Sessiz Ã§alÄ±ÅŸma modu iÃ§in
options(readr.show_progress = FALSE)

ana_klasor_yolu <- "C:/Users/Enis/Desktop/AZIOSB"

# Alt klasÃ¶rleri bul
alt_klasorler <- list.dirs(ana_klasor_yolu, full.names = TRUE, recursive = FALSE)
cat("Alt klasÃ¶r sayÄ±sÄ±:", length(alt_klasorler), "\n")

csv_to_xlsx_count <- 0
toplam_csv <- 0

# Ã–nce toplam CSV sayÄ±sÄ±nÄ± hesapla
for (klasor in alt_klasorler) {
  csv_sayisi <- length(list.files(path = klasor, pattern = "\\.csv$|\\.CSV$"))
  toplam_csv <- toplam_csv + csv_sayisi
}

cat("Toplam CSV dosyasÄ±:", toplam_csv, "\n")
cat("DÃ¶nÃ¼ÅŸtÃ¼rme baÅŸlÄ±yor...\n")

for (klasor in alt_klasorler) {
  csv_dosyalari <- list.files(path = klasor, pattern = "\\.csv$|\\.CSV$", full.names = TRUE)
  
  for (csv_dosya in csv_dosyalari) {
    tryCatch({
      # TÃ¼m mesajlarÄ± bastÄ±r
      invisible(capture.output({
        veri <- read_delim(csv_dosya, delim = ";", locale = locale(encoding = "UTF-8"), 
                          show_col_types = FALSE, progress = FALSE)
      }))
      
      dosya_adi <- basename(csv_dosya)
      dosya_adi_xlsx <- str_replace(dosya_adi, "\\.csv$|\\.CSV$", ".xlsx")
      xlsx_dosya_yolu <- file.path(klasor, dosya_adi_xlsx)
      
      write_xlsx(veri, xlsx_dosya_yolu)
      csv_to_xlsx_count <- csv_to_xlsx_count + 1
      
    }, error = function(e) {
      cat("Hata:", basename(csv_dosya), "\n")
    })
  }
}

cat("TamamlandÄ±! Toplam", csv_to_xlsx_count, "dosya dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼.\n")

```

#### 1.3. XLXS TÃ¼rÃ¼ne DÃ¶nÃ¼ÅŸtÃ¼rÃ¼len Veri Setini RSTUDIO'YA YÃœKLEME

```{r}
tum_xlsx_dosyalari <- list()
for (klasor in alt_klasorler) {
  xlsx_dosyalari <- list.files(path = klasor, pattern = "\\.xlsx$|\\.XLSX$", full.names = TRUE)
  tum_xlsx_dosyalari <- c(tum_xlsx_dosyalari, xlsx_dosyalari)
}

cat("Ä°ÅŸlenecek toplam XLSX dosya sayÄ±sÄ±:", length(tum_xlsx_dosyalari), "\n")
```

```{r}
# TÃ¼m Excel dosyalarÄ±nÄ± oku ve birleÅŸtir
veri_toplam <- data.frame()
basarili_okunan <- 0

for (dosya in tum_xlsx_dosyalari) {
  # DosyayÄ± oku
  temp_veri <- tryCatch({
    read_excel(dosya)
  }, error = function(e) {
    cat("Hata:", dosya, "dosyasÄ± okunamadÄ±.\n")
    cat("Hata mesajÄ±:", e$message, "\n")
    return(NULL)
  })
  
  if (!is.null(temp_veri)) {
    # SÃ¼tun adlarÄ±nÄ± kontrol et ve dÃ¼zelt (bazÄ± dosyalarda sÃ¼tun adlarÄ± farklÄ± olabilir)
    if (!"Tarih-Saat" %in% names(temp_veri) && "Tarih" %in% names(temp_veri)) {
      names(temp_veri)[which(names(temp_veri) == "Tarih")] <- "Tarih-Saat"
    }
    
    # Dosya adÄ± ve klasÃ¶r bilgisini ekle
    temp_veri$Dosya_Adi <- basename(dosya)
    temp_veri$Klasor_Adi <- basename(dirname(dosya))
    
    # Ana veri setine ekle
    veri_toplam <- bind_rows(veri_toplam, temp_veri)
    basarili_okunan <- basarili_okunan + 1
  }
}
cat("BaÅŸarÄ±yla okunan ve birleÅŸtirilen dosya sayÄ±sÄ±:", basarili_okunan, "\n")
cat("Toplam veri satÄ±r sayÄ±sÄ±:", nrow(veri_toplam), "\n\n")

tail(veri_toplam)

cat("Veri seti sÃ¼tunlarÄ±:", paste(names(veri_toplam), collapse = ", "), "\n\n")
```

#### 1.4. Veri Temizleme ve HazÄ±rlama

```{r}

veri_toplam$`Tarih-Saat` <- as.POSIXct(veri_toplam$`Tarih-Saat`, format="%d-%m-%Y %H:%M:%S")

veri_toplam$`Tarih-Saat` <- ymd_hms(veri_toplam$`Tarih-Saat`)

veri_toplam <- veri_toplam %>%

  mutate(

    Yil = year(`Tarih-Saat`),

    Ay = month(`Tarih-Saat`),

    Gun = day(`Tarih-Saat`),

    Saat = hour(`Tarih-Saat`),

    Dakika = minute(`Tarih-Saat`),

    Haftanin_Gunu = wday(`Tarih-Saat`, label = TRUE),

    Hafta_Sonu = ifelse(wday(`Tarih-Saat`) %in% c(1, 7), "Hafta Sonu", "Hafta Ä°Ã§i")

  )
veri_toplam <- veri_toplam %>%
  mutate(
    Giris1_Anlik = Giris1_Anlik / 10000,
    Giris1_Toplam = Giris1_Toplam / 10000,
    Giris1_Sabit_Toplam = Giris1_Sabit_Toplam / 10000
  )

# Veri setinin Ã¶zetini gÃ¶ster

summary(veri_toplam)

# AykÄ±rÄ± deÄŸerleri tespit et (Giris1_Anlik iÃ§in)

Q1 <- quantile(veri_toplam$Giris1_Anlik, 0.25, na.rm = TRUE)

Q3 <- quantile(veri_toplam$Giris1_Anlik, 0.75, na.rm = TRUE)

IQR <- Q3 - Q1

alt_sinir <- Q1 - 1.5 * IQR

ust_sinir <- Q3 + 1.5 * IQR

outliers <- veri_toplam %>% 

  filter(Giris1_Anlik < alt_sinir | Giris1_Anlik > ust_sinir)

veri_temiz <- veri_toplam %>%

  filter(Giris1_Anlik >= alt_sinir & Giris1_Anlik <= ust_sinir)

cat("AykÄ±rÄ± deÄŸer sayÄ±sÄ±:", nrow(outliers), "\n")

# Herhangi bir sÃ¼tunda NA olan satÄ±rlarÄ± sil
veri_toplam <- veri_toplam %>%
  na.omit()

summary(veri_toplam)
```

#### 2. Veri GÃ¶rselleÅŸtirme Ve Analizi

#### 2.1. TanÄ±mlayÄ±cÄ± Veri Analizi Grafikleri

##### GÃ¼nlÃ¼k Ortalama AtÄ±k MiktarÄ± GrafiÄŸi

```{r}
gunluk_analiz <- veri_toplam %>%
  group_by(Yil, Ay, Gun) %>%
  summarise(
    Ortalama_Anlik = mean(Giris1_Anlik, na.rm = TRUE),
    Toplam_Gunluk_Artis = max(Giris1_Toplam) - min(Giris1_Toplam),
    n = n(),
    .groups = "drop"
  ) %>%
  mutate(Tarih = as.Date(paste(Yil, Ay, Gun, sep = "-")))

# GÃ¼nlÃ¼k analiz grafiÄŸi
p1 <- ggplot(gunluk_analiz, aes(x = Tarih, y = Ortalama_Anlik)) +
  geom_line(color = "blue") +
  geom_smooth(method = "loess", color = "red") +
  labs(title = "GÃ¼nlÃ¼k Ortalama AtÄ±k MiktarÄ±",
       x = "Tarih",
       y = "Ortalama AnlÄ±k AtÄ±k") +
  theme_minimal() +
  scale_x_date(date_labels = "%b %Y", date_breaks = "1 month")

print(p1)
ggsave("Gunluk_Ortalama_Atik.png", p1, width = 10, height = 6)

```

##### HaftaiÃ§i ve Haftasonu Ortalama AtÄ±k MiktarÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±

```{r}
#HaftaiÃ§i ve Hafta sonu Ortalama AtÄ±k MiktarÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±
hafta_karsilastirma <- veri_toplam %>%
  group_by(Hafta_Sonu) %>%
  summarise(
    Ortalama_Anlik = mean(Giris1_Anlik, na.rm = TRUE),
    Std_Sapma = sd(Giris1_Anlik, na.rm = TRUE),
    .groups = "drop"
  )
p3 <- ggplot(hafta_karsilastirma, aes(x = Hafta_Sonu, y = Ortalama_Anlik, fill = Hafta_Sonu)) +
  geom_bar(stat = "identity") +
  geom_errorbar(aes(ymin = Ortalama_Anlik - Std_Sapma, 
                   ymax = Ortalama_Anlik + Std_Sapma), 
               width = 0.2) +
  labs(title = "Hafta Ä°Ã§i vs Hafta Sonu AtÄ±k KarÅŸÄ±laÅŸtÄ±rmasÄ±",
       x = "",
       y = "Ortalama AnlÄ±k AtÄ±k") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1")

print(p3)
```

##### Saatlik Analiz (gÃ¼nÃ¼n hangi saatinde atÄ±k miktarÄ± daha yÃ¼ksek)

```{r}
#Saatlik analiz (gÃ¼nÃ¼n hangi saatinde atÄ±k miktarÄ± daha yÃ¼ksek)
saatlik_analiz <- veri_toplam %>%
  group_by(Saat) %>%
  summarise(
    Ortalama_Anlik = mean(Giris1_Anlik, na.rm = TRUE),
    Std_Sapma = sd(Giris1_Anlik, na.rm = TRUE),
    .groups = "drop"
  )

p4 <- ggplot(saatlik_analiz, aes(x = Saat, y = Ortalama_Anlik)) +
  geom_line(color = "purple", size = 1) +
  geom_point(size = 2) +
  geom_ribbon(aes(ymin = Ortalama_Anlik - Std_Sapma, 
                 ymax = Ortalama_Anlik + Std_Sapma), 
             alpha = 0.2) +
  labs(title = "GÃ¼nÃ¼n Saatlerine GÃ¶re AtÄ±k MiktarÄ±",
       x = "Saat",
       y = "Ortalama AnlÄ±k AtÄ±k") +
  theme_minimal() +
  scale_x_continuous(breaks = 0:23)

print(p4)
```

##### Aylar ArasÄ± AtÄ±k MiktarÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±

```{r}
#Aylar ArasÄ± AtÄ±k MiktarÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±
aylik_analiz <- veri_toplam %>%
  group_by(Yil, Ay) %>%
  summarise(
    Ortalama_Anlik = mean(Giris1_Anlik, na.rm = TRUE),
    Toplam_Artis = sum(Giris1_Anlik, na.rm = TRUE ),
    .groups = "drop"
  ) %>%
  mutate(Ay_Adi = month.abb[Ay],
         Ay_Yil = paste(Ay_Adi, Yil))

p_aylik <- ggplot(aylik_analiz, aes(x = reorder(Ay_Yil, Yil*100 + Ay), y = Ortalama_Anlik, group = 1)) +
  geom_line() +
  geom_point() +
  labs(title = "AylÄ±k Ortalama AtÄ±k MiktarÄ±",
       x = "",
       y = "Ortalama AnlÄ±k AtÄ±k") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(p_aylik)
ggsave("Aylik_Ortalama_Atik.png", p_aylik, width = 12, height = 6)

```

##### HaftanÄ±n GÃ¼nlerine GÃ¶re AtÄ±k MiktarÄ± Analizi

```{r}
# HaftanÄ±n GÃ¼nlerine GÃ¶re AtÄ±k MiktarÄ± Analizi
gunler_analiz <- veri_toplam %>%
  group_by(Haftanin_Gunu) %>%
  summarise(
    Ortalama_Anlik = mean(Giris1_Anlik, na.rm = TRUE),
    Std_Sapma = sd(Giris1_Anlik, na.rm = TRUE),
    .groups = "drop"
  )

p_gunler <- ggplot(gunler_analiz, aes(x = Haftanin_Gunu, y = Ortalama_Anlik, fill = Haftanin_Gunu)) +
  geom_bar(stat = "identity") +
  geom_errorbar(aes(ymin = Ortalama_Anlik - Std_Sapma, 
                   ymax = Ortalama_Anlik + Std_Sapma), 
               width = 0.2) +
  labs(title = "HaftanÄ±n GÃ¼nlerine GÃ¶re Ortalama AtÄ±k MiktarÄ±",
       x = "",
       y = "Ortalama AnlÄ±k AtÄ±k") +
  theme_minimal() +
  theme(legend.position = "none")

print(p_gunler)
ggsave("Gunlere_Gore_Ortalama_Atik.png", p_gunler, width = 10, height = 6)

```

##### HaftanÄ±n GÃ¼nlerine GÃ¶re IsÄ± HaritasÄ±

```{r}
#HaftanÄ±n GÃ¼nlerine GÃ¶re IsÄ± HaritasÄ±
isik_haritasi <- veri_toplam %>%
  group_by(Haftanin_Gunu, Saat) %>%
  summarise(
    Ortalama_Anlik = mean(Giris1_Anlik, na.rm = TRUE),
    .groups = "drop"
  )

p_isik <- ggplot(isik_haritasi, aes(x = factor(Saat), y = Haftanin_Gunu, fill = Ortalama_Anlik)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "steelblue") +
  labs(title = "GÃ¼n ve Saatlere GÃ¶re AtÄ±k MiktarÄ± IsÄ± HaritasÄ±",
       x = "Saat",
       y = "",
       fill = "Ortalama\nAnlÄ±k AtÄ±k") +
  theme_minimal() +
  scale_x_discrete(breaks = c(0, 6, 12, 18, 23))

print(p_isik)
ggsave("Gun_Saat_Isi_Haritasi.png", p_isik, width = 10, height = 6)
```

#### ARIMA

##### Zaman Serisi

```{r}
## zaman zerisini oluÅŸturduk
deneme_zs <- ts(gunluk_analiz$Ortalama_Anlik, start = (min(veri_toplam$Yil, min(veri_toplam$Ay))), frequency = 12)
###
decomp <- stl(deneme_zs, s.window = "periodic")
```

##### Verileri AyrÄ±ÅŸtÄ±rma

```{r}
# AyrÄ±ÅŸtÄ±rma sonuÃ§larÄ±nÄ± bir veri Ã§erÃ§evesine dÃ¶nÃ¼ÅŸtÃ¼r
deneme_decomp_df <- data.frame(
  Tarih = gunluk_analiz$Tarih,
  Observed = decomp$time.series[,1] + decomp$time.series[,2] + decomp$time.series[,3],
  Trend = decomp$time.series[,2],
  Seasonal = decomp$time.series[,1],
  Random = decomp$time.series[,3]
)
```

##### Mevsimsel, Rastgele ve Trend BileÅŸenleri

##### Trend

```{r}
# Mevsimsel, trend ve rastgele bileÅŸenleri Ã§izdir
p_decomp_deneme <- ggplot() +
  geom_line(data = deneme_decomp_df, aes(x = Tarih, y = Observed), color = "black") +
  geom_line(data = deneme_decomp_df, aes(x = Tarih, y = Trend), color = "blue", size = 1) +
  labs(title = "AtÄ±k MiktarÄ± Zaman Serisi ve Trend",
       x = "Tarih",
       y = "AtÄ±k MiktarÄ±") +
  theme_minimal()

print(p_decomp_deneme)
ggsave("Deneme_Zaman_Serisi_Trend.png", p_decomp_deneme, width = 10, height = 6)
```

##### Mevsimsellik

```{r}
# Mevsimsellik grafiÄŸi
p_seasonal_deneme <- ggplot(deneme_decomp_df, aes(x = Tarih, y = Seasonal)) +
  geom_line(color = "black") +
  labs(title = "Mevsimsel BileÅŸen",
       x = "Tarih",
       y = "Mevsimsel Etki") +
  theme_minimal()

print(p_seasonal_deneme)
ggsave("Deneme_Mevsimsel_Bilesen.png", p_seasonal_deneme, width = 10, height = 4)
```

##### Rastgele BileÅŸen

```{r}
p_random_deneme <- ggplot(deneme_decomp_df, aes(x = Tarih, y = Random)) +
  geom_line(color = "red") +
  labs(title = "Rastgele BileÅŸen",
       x = "Tarih",
       y = "Rastgele DeÄŸiÅŸim") +
  theme_minimal()

print(p_random_deneme)
ggsave("deneme_Rastgele_Bilesen.png", p_random_deneme, width = 10, height = 4)
```

##### ADF Testi (DuraÄŸanlÄ±k Ã–lÃ§Ã¼mÃ¼)

H0: Seri DuraÄŸan DeÄŸildir.

H1: Seri DuraÄŸandÄ±r.

```{r}
adf.test(deneme_zs)
# p deÄŸeri 0.09967 Ã§Ä±ktÄ±. p>0,05 olduÄŸundan dolayÄ± H0 kabul. Seri duraÄŸan deÄŸildir. O  halde mevsimsellik bulunduÄŸuna gÃ¶re zaman serisine SARIMA modellemesi kullanacaÄŸÄ±z.
```

H0 kabul olduÄŸundan dolayÄ± burada seri duraÄŸan deÄŸildir yani Differencing (I bileÅŸeni) gereklidir. Mevsimsellik grafiÄŸini de incelediÄŸimizde mevsimselliÄŸin olduÄŸu gÃ¶zÃ¼kmektedir. O halde ;

```{r}
auto_sarima <- auto.arima(deneme_zs,
                          seasonal = TRUE,
                          stepwise = FALSE,
                          approximation = FALSE)

print(auto_sarima)
```

auto.arima fonksiyonun bize verdiÄŸi modele gÃ¶re ARIMA(1,1,4)\
p=1 : 1 autoregressive (AR) terimi\
d=1 : 1 kez differencing (seri 1 kez fark alÄ±narak duraÄŸan hale getirildi.)\
q=4 : 4 moving average (MA) terimi

KatsayÄ±larÄ±n Analizi:

AR KatsayÄ±sÄ±:

-   AR1 = -0,7248: Negatif ve gÃ¼Ã§lÃ¼, Ã¶nceki deÄŸerin ters yÃ¶nde etkisi var.

MA KatsayÄ±larÄ±:

-   MA1 = 0,0862 : ZayÄ±f pozitif etki

-   MA2 = -0,6634 : GÃ¼Ã§lÃ¼ negatif etki (en Ã¶nemli MA terimi)

-   MA3 = - 0,0774 : ZayÄ±f negatif etki

-   MA4 = -0,1024 : ZayÄ±f negatif etki

KatsayÄ±larÄ±n AnlamlÄ±ÅŸÄ±

AR1: \|-0.7248/0.1025\| = 7.07 âœ“ (Ã‡ok anlamlÄ±) MA1: \|0.0862/0.1107\| = 0.78 âœ— (AnlamlÄ± deÄŸil) MA2: \|-0.6634/0.0786\| = 8.44 âœ“ (Ã‡ok anlamlÄ±) MA3: \|-0.0774/0.0679\| = 1.14 âœ— (AnlamlÄ± deÄŸil) MA4: \|-0.1024/0.0563\| = 1.82 âœ— (SÄ±nÄ±rda)

Model Kalitesi:

-   AIC = 2094,46 : Model karÅŸÄ±laÅŸtrÄ±masÄ± iÃ§in (dÃ¼ÅŸÃ¼k olmasÄ± daha iyi)

-   BIC = 2117,86 : Daha az parametre tercih eder

-   sigma\^2 = 17,77 : Hata varyansÄ±

Yorum: Model genel olarak iyi (AR1 ve MA2 gÃ¼Ã§lÃ¼ ve anlamlÄ±) fakat MA1, MA3 MA4 zayÄ±f bu da bize daha basit bir model ile karÅŸÄ±laÅŸtÄ±rmamÄ±z gerektiÄŸini gÃ¶steriyor.

Alternatif Test:

```{r}
arima_simple <- arima(deneme_zs, order = c(1,1,2))
AIC(arima_simple)  # Bu modelle karÅŸÄ±laÅŸtÄ±r
```

SARIMA tek baÅŸÄ±na yeterli deÄŸildir Ã§Ã¼nkÃ¼;

$$
Model~ Fitting \neq Model ~Quality \\AIC~dÃ¼ÅŸÃ¼k~ olmasÄ± \neq Residual'lar ~temiz \\ Parametreler~AnlamlÄ± \neq VarsayÄ±mlar~ SaÄŸlanÄ±yor~
$$

Residual Analizi olmadan model kullanÄ±lÄ±rsa ;

$$
YanlÄ±ÅŸ~Tahminler\\ GÃ¼venilmez~confidence~interval'ler\\Bias'lÄ±~sonuÃ§lar~ortaya~Ã§Ä±kabilir.~Bu~yÃ¼zden~her~zaman~residual~analizi~yapmalÄ±yÄ±z!
$$

collapse="-"), "\\n")

cat("Test dÃ¶nemi:", paste(start(test_data), collapse="-"), "ile",

paste(end(test_data), collapse="-"), "\\n")

\# 3. MODEL EÄÄ°TÄ°MÄ° (Sadece train verisi)

cat("\\n=== MODEL EÄÄ°TÄ°MÄ° ===\\n")

cat("Model sadece train verisi Ã¼zerinde eÄŸitiliyor...\\n")

auto_arima_train \<- auto.arima(train_data,

seasonal = TRUE,

stepwise = FALSE,

approximation = FALSE)

cat("EÄŸitilen model:\\n")

print(auto_arima_train)

\# 4. TAHMÄ°N (Test periyodu kadar)

cat("\\n=== TAHMÄ°N YAPILIYOR ===\\n")

forecast_test \<- forecast(auto_arima_train, h = test_size)

cat("Test periyodu iÃ§in", test_size, "adÄ±m tahmin yapÄ±ldÄ±\\n")

\# 5. PERFORMANS DEÄERLENDÄ°RMESÄ°

cat("\\n=== PERFORMANS KARÅILAÅTIRMASI ===\\n")

\# Train performansÄ±

train_accuracy \<- accuracy(auto_arima_train)

cat("TRAIN SETÄ° PERFORMANSI:\\n")

print(train_accuracy)

\# Test performansÄ± (GERÃ‡EKLEÅTÄ°RÄ°LEN TEST)

test_accuracy \<- accuracy(forecast_test, test_data)

cat("\\nTEST SETÄ° PERFORMANSI:\\n")

print(test_accuracy)

\# KarÅŸÄ±laÅŸtÄ±rma

train_rmse \<- train_accuracy\[2\] \# RMSE

test_rmse \<- test_accuracy\[1,2\] \# Test RMSE

cat("\\n=== OVERFITTING KONTROLÃœ ===\\n")

cat("Train RMSE:", round(train_rmse, 4), "\\n")

cat("Test RMSE:", round(test_rmse, 4), "\\n")

cat("Test/Train RMSE oranÄ±:", round(test_rmse/train_rmse, 2), "\\n")

if(test_rmse \> train_rmse \* 1.5) {

cat("ï¸ UYARI: OVERFITTING riski yÃ¼ksek!\\n")

cat(" Model train verisini ezberliyor olabilir\\n")

} else if(test_rmse \> train_rmse \* 1.2) {

cat(" DÄ°KKAT: Hafif overfitting var\\n")

} else {

cat(" Model saÄŸlÄ±klÄ± - Overfitting yok\\n")

}

\# 6. GÃ–RSEL KARÅILAÅTIRMA

cat("\\n=== GÃ–RSELLEÅTÄ°RME ===\\n")

\# TÃ¼m veriyi birleÅŸtir

all_time \<- time(deneme_zs)

train_time \<- head(all_time, train_size)

test_time \<- tail(all_time, test_size)

\# Grafik verisi oluÅŸtur

plot_data \<- data.frame(

time = c(train_time, test_time),

actual = as.numeric(deneme_zs),

type = c(rep("Train", train_size), rep("Test", test_size)),

forecast = c(rep(NA, train_size), as.numeric(forecast_test\$mean)),

lower_95 = c(rep(NA, train_size), as.numeric(forecast_test\$lower\[,2\])),

upper_95 = c(rep(NA, train_size), as.numeric(forecast_test\$upper\[,2\]))

)

\# Ana grafik

p_main \<- ggplot(plot_data, aes(x = time)) +

\# GÃ¼ven aralÄ±ÄŸÄ±

geom_ribbon(aes(ymin = lower_95, ymax = upper_95),

fill = "lightblue", alpha = 0.3, na.rm = TRUE) +

\# GerÃ§ek deÄŸerler

geom_line(aes(y = actual, color = type), size = 1) +

\# Tahminler

geom_line(aes(y = forecast), color = "red", size = 1, na.rm = TRUE) +

\# Dikey Ã§izgi (train/test ayrÄ±mÄ±)

geom_vline(xintercept = max(train_time), linetype = "dashed", color = "gray50") +

scale_color_manual(values = c("Train" = "blue", "Test" = "black")) +

ggtitle("Zaman Serisi: Train/Test AyrÄ±mÄ± ve Tahminler") +

xlab("Zaman") +

ylab("DeÄŸer") +

theme_minimal() +

theme(legend.position = "bottom")

print(p_main)

\# 7. HATA ANALÄ°ZÄ°

forecast_errors \<- as.numeric(test_data) - as.numeric(forecast_test\$mean)

cat("\\n=== DETAYLI HATA METRÄ°KLERÄ° ===\\n")

cat("MAE (Mean Absolute Error):", round(mean(abs(forecast_errors)), 4), "\\n")

cat("RMSE (Root Mean Square Error):", round(sqrt(mean(forecast_errors\^2)), 4), "\\n")

cat("MAPE (Mean Absolute Percentage Error):",

round(mean(abs(forecast_errors/as.numeric(test_data))\*100), 2), "%\\n")

\# Hata daÄŸÄ±lÄ±mÄ±

error_df \<- data.frame(errors = forecast_errors)

p_errors \<- ggplot(error_df, aes(x = errors)) +

geom_histogram(bins = 20, fill = "lightcoral", alpha = 0.7) +

geom_vline(xintercept = 0, color = "red", linetype = "dashed") +

ggtitle("Tahmin HatalarÄ±nÄ±n DaÄŸÄ±lÄ±mÄ±") +

xlab("Hata") +

ylab("Frekans") +

theme_minimal()

print(p_errors)

\# 8. RESIDUAL ANALÄ°ZÄ° (Train verisi iÃ§in)

cat("\\n=== RESÄ°DUAL ANALÄ°ZÄ° (TRAIN) ===\\n")

residuals_train \<- residuals(auto_arima_train)

\# Ljung-Box test

ljung_test \<- Box.test(residuals_train, lag = 10, type = "Ljung-Box")

cat("Ljung-Box test p-value:", round(ljung_test\$p.value, 4), "\\n")

if(ljung_test\$p.value \> 0.05) {

cat("Residuals'da otokorelasyon YOK\\n")

} else {

cat("Residuals'da otokorelasyon VAR - Model yetersiz\\n")

}

\# 9. SONUÃ‡ Ã–ZETÄ°

cat("\\n" , "="\*50, "\\n")

cat("SONUÃ‡ Ã–ZETÄ°\\n")

cat("="\*50, "\\n")

cat("Model Tipi:", paste(auto_arima_train\$arma\[c(1,6,2,3,7,4,5)\], collapse=","), "\\n")

cat("Train RMSE:", round(train_rmse, 4), "\\n")

cat("Test RMSE:", round(test_rmse, 4), "\\n")

cat("Model GÃ¼venilirliÄŸi:",

ifelse(test_rmse \<= train_rmse \* 1.2, "YÃ¼ksek ", "DÃ¼ÅŸÃ¼k "), "\\n")

cat("Residual Kalitesi:",

ifelse(ljung_test\$p.value \> 0.05, "Ä°yi", "KÃ¶tÃ¼ "), "\\n")

\# 10. TAVSÄ°YELER

cat("\\nTAVSÄ°YELER:\\n")

if(test_rmse \> train_rmse \* 1.5) {

cat("- Model Ã§ok karmaÅŸÄ±k, daha basit model deneyin\\n")

cat("- Veri Ã¶n iÅŸleme adÄ±mlarÄ±nÄ± gÃ¶zden geÃ§irin\\n")

}

if(ljung_test\$p.value \<= 0.05) {

cat("- FarklÄ± ARIMA parametreleri deneyin\\n")

cat("- Mevsimsel diferansiyasyon ekleyin\\n")

}

if(test_rmse \<= train_rmse \* 1.1) {

cat("- Model Ã§ok baÅŸarÄ±lÄ±! \\n")

cat("- Ãœretim ortamÄ±nda kullanÄ±labilir\\n")

}

```{r}
# =============================================================================
# ZAMAN SERÄ°SÄ° ANALÄ°ZÄ° - EKSÄ°KSÄ°Z RESIDUAL ANALÄ°ZÄ° Ä°LE
# =============================================================================

# Gerekli kÃ¼tÃ¼phaneler
library(forecast)
library(ggplot2)
library(gridExtra)

# 1. VERÄ° BÃ–LÃœNMESÄ° (Kronolojik sÄ±rayÄ± koruyarak)
cat("=== VERÄ° BÃ–LÃœNME STRATEJÄ°SÄ° ===\n")
n <- length(deneme_zs)
cat("Toplam gÃ¶zlem sayÄ±sÄ±:", n, "\n")

# Zaman serisi iÃ§in Ã¶nerilen bÃ¶lÃ¼nme stratejileri:
# Strateji 1: %80-20 (genel)
train_size_80 <- floor(0.8 * n)

# Strateji 2: Son 12 ay test (aylÄ±k veri iÃ§in)
train_size_12m <- n - 12

# Strateji 3: Son 1 yÄ±l test (yÄ±llÄ±k veri iÃ§in) 
train_size_1y <- n - 1

# Hangi stratejiyi seÃ§eceÄŸinize karar verin
cat("SeÃ§enekler:\n")
cat("1. %80 Train (%20 Test):", train_size_80, "vs", n - train_size_80, "\n")
cat("2. Son 12 ay Test:", train_size_12m, "vs", 12, "\n")
cat("3. Son 1 yÄ±l Test:", train_size_1y, "vs", 1, "\n")

# En uygun olanÄ± seÃ§in (Ã¶rnek: son 12 ay)
train_size <- train_size_12m
test_size <- n - train_size

cat("\nSeÃ§ilen strateji: Son", test_size, "periode test\n")
cat("Train:", train_size, "gÃ¶zlem\n")
cat("Test:", test_size, "gÃ¶zlem\n")

# 2. VERÄ° AYIRMA (Zaman sÄ±rasÄ±nÄ± koruyarak)
train_data <- head(deneme_zs, train_size)
test_data <- tail(deneme_zs, test_size)

# Zaman aralÄ±klarÄ±nÄ± kontrol et
cat("Train dÃ¶nemi:", paste(start(train_data), collapse="-"), "ile", 
    paste(end(train_data), collapse="-"), "\n")
cat("Test dÃ¶nemi:", paste(start(test_data), collapse="-"), "ile", 
    paste(end(test_data), collapse="-"), "\n")

# 3. MODEL EÄÄ°TÄ°MÄ° (Sadece train verisi)
cat("\n=== MODEL EÄÄ°TÄ°MÄ° ===\n")
cat("Model sadece train verisi Ã¼zerinde eÄŸitiliyor...\n")

auto_arima_train <- auto.arima(train_data, 
                               seasonal = TRUE, 
                               stepwise = FALSE, 
                               approximation = FALSE)

cat("EÄŸitilen model:\n")
print(auto_arima_train)

# 4. TAHMÄ°N (Test periyodu kadar)
cat("\n=== TAHMÄ°N YAPILIYOR ===\n")
forecast_test <- forecast(auto_arima_train, h = test_size)
cat("Test periyodu iÃ§in", test_size, "adÄ±m tahmin yapÄ±ldÄ±\n")

# 5. PERFORMANS DEÄERLENDÄ°RMESÄ°
cat("\n=== PERFORMANS KARÅILAÅTIRMASI ===\n")

# Train performansÄ±
train_accuracy <- accuracy(auto_arima_train)
cat("TRAIN SETÄ° PERFORMANSI:\n")
print(train_accuracy)

# Test performansÄ± (GERÃ‡EKLEÅTÄ°RÄ°LEN TEST)
test_accuracy <- accuracy(forecast_test, test_data)
cat("\nTEST SETÄ° PERFORMANSI:\n")
print(test_accuracy)

# KarÅŸÄ±laÅŸtÄ±rma
train_rmse <- train_accuracy[2]  # RMSE
test_rmse <- test_accuracy[1,2]  # Test RMSE

cat("\n=== OVERFITTING KONTROLÃœ ===\n")
cat("Train RMSE:", round(train_rmse, 4), "\n")
cat("Test RMSE:", round(test_rmse, 4), "\n")
cat("Test/Train RMSE oranÄ±:", round(test_rmse/train_rmse, 2), "\n")

if(test_rmse > train_rmse * 1.5) {
  cat("âš ï¸  UYARI: OVERFITTING riski yÃ¼ksek!\n")
  cat("   Model train verisini ezberliyor olabilir\n")
} else if(test_rmse > train_rmse * 1.2) {
  cat("âš ï¸ DÄ°KKAT: Hafif overfitting var\n")
} else {
  cat("âœ… Model saÄŸlÄ±klÄ± - Overfitting yok\n")
}

# 6. GÃ–RSEL KARÅILAÅTIRMA
cat("\n=== GÃ–RSELLEÅTÄ°RME ===\n")

# TÃ¼m veriyi birleÅŸtir
all_time <- time(deneme_zs)
train_time <- head(all_time, train_size)
test_time <- tail(all_time, test_size)

# Grafik verisi oluÅŸtur
plot_data <- data.frame(
  time = c(train_time, test_time),
  actual = as.numeric(deneme_zs),
  type = c(rep("Train", train_size), rep("Test", test_size)),
  forecast = c(rep(NA, train_size), as.numeric(forecast_test$mean)),
  lower_95 = c(rep(NA, train_size), as.numeric(forecast_test$lower[,2])),
  upper_95 = c(rep(NA, train_size), as.numeric(forecast_test$upper[,2]))
)

# Ana grafik
p_main <- ggplot(plot_data, aes(x = time)) +
  # GÃ¼ven aralÄ±ÄŸÄ±
  geom_ribbon(aes(ymin = lower_95, ymax = upper_95), 
              fill = "lightblue", alpha = 0.3, na.rm = TRUE) +
  # GerÃ§ek deÄŸerler
  geom_line(aes(y = actual, color = type), size = 1) +
  # Tahminler
  geom_line(aes(y = forecast), color = "red", size = 1, na.rm = TRUE) +
  # Dikey Ã§izgi (train/test ayrÄ±mÄ±)
  geom_vline(xintercept = max(train_time), linetype = "dashed", color = "gray50") +
  scale_color_manual(values = c("Train" = "blue", "Test" = "black")) +
  ggtitle("Zaman Serisi: Train/Test AyrÄ±mÄ± ve Tahminler") +
  xlab("Zaman") +
  ylab("DeÄŸer") +
  theme_minimal() +
  theme(legend.position = "bottom")

print(p_main)

# 7. HATA ANALÄ°ZÄ°
forecast_errors <- as.numeric(test_data) - as.numeric(forecast_test$mean)

cat("\n=== DETAYLI HATA METRÄ°KLERÄ° ===\n")
cat("MAE (Mean Absolute Error):", round(mean(abs(forecast_errors)), 4), "\n")
cat("RMSE (Root Mean Square Error):", round(sqrt(mean(forecast_errors^2)), 4), "\n")
cat("MAPE (Mean Absolute Percentage Error):", 
    round(mean(abs(forecast_errors/as.numeric(test_data))*100), 2), "%\n")

# Hata daÄŸÄ±lÄ±mÄ±
error_df <- data.frame(errors = forecast_errors)
p_errors <- ggplot(error_df, aes(x = errors)) +
  geom_histogram(bins = 20, fill = "lightcoral", alpha = 0.7) +
  geom_vline(xintercept = 0, color = "red", linetype = "dashed") +
  ggtitle("Tahmin HatalarÄ±nÄ±n DaÄŸÄ±lÄ±mÄ±") +
  xlab("Hata") +
  ylab("Frekans") +
  theme_minimal()

print(p_errors)

# =============================================================================
# 8. EKSÄ°KSÄ°Z RESIDUAL ANALÄ°ZÄ° (TRAIN verisi iÃ§in)
# =============================================================================
cat("\n=== EKSÄ°KSÄ°Z RESÄ°DUAL ANALÄ°ZÄ° (TRAIN) ===\n")
residuals_train <- residuals(auto_arima_train)

# 8.1 Ljung-Box Test
ljung_test <- Box.test(residuals_train, lag = 10, type = "Ljung-Box")
cat("Ljung-Box test p-value:", round(ljung_test$p.value, 4), "\n")

if(ljung_test$p.value > 0.05) {
  cat(" Residuals'da otokorelasyon YOK\n")
} else {
  cat(" Residuals'da otokorelasyon VAR - Model yetersiz\n")
}

# 8.2 Shapiro-Wilk Normallik Testi
shapiro_test <- shapiro.test(residuals_train)
cat("Shapiro-Wilk test p-value:", round(shapiro_test$p.value, 4), "\n")

if(shapiro_test$p.value > 0.05) {
  cat(" Residuals normal daÄŸÄ±lÄ±mlÄ±\n")
} else {
  cat(" Residuals normal daÄŸÄ±lÄ±mlÄ± DEÄÄ°L\n")
}

# 8.3 RESÄ°DUAL GRAFÄ°KLERÄ° (4'lÃ¼ panel)

# ACF Plot
p_acf <- ggAcf(residuals_train, lag.max = 20) + 
  ggtitle("ACF of Residuals") + 
  theme_minimal()

# PACF Plot  
p_pacf <- ggPacf(residuals_train, lag.max = 20) + 
  ggtitle("PACF of Residuals") + 
  theme_minimal()

# Q-Q Plot
residuals_df <- data.frame(residuals = as.numeric(residuals_train))
p_qq <- ggplot(residuals_df, aes(sample = residuals)) +
  stat_qq() + 
  stat_qq_line(color = "red") +
  ggtitle("Q-Q Plot of Residuals") +
  xlab("Theoretical Quantiles") +
  ylab("Sample Quantiles") +
  theme_minimal()

# Residuals vs Time
time_residuals <- data.frame(
  time = as.numeric(time(residuals_train)),
  residuals = as.numeric(residuals_train)
)
p_res_time <- ggplot(time_residuals, aes(x = time, y = residuals)) +
  geom_line(color = "blue") +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  ggtitle("Residuals vs Time") +
  xlab("Time") +
  ylab("Residuals") +
  theme_minimal()

# Residuals Histogram
p_res_hist <- ggplot(residuals_df, aes(x = residuals)) +
  geom_histogram(aes(y = ..density..), bins = 20, fill = "lightblue", alpha = 0.7) +
  geom_density(color = "red", size = 1) +
  stat_function(fun = dnorm, 
                args = list(mean = mean(residuals_train), 
                           sd = sd(residuals_train)),
                color = "blue", linetype = "dashed") +
  ggtitle("Residuals Histogram with Normal Curve") +
  xlab("Residuals") +
  ylab("Density") +
  theme_minimal()

# TÃ¼m residual grafiklerini gÃ¶ster
cat("\n=== RESÄ°DUAL GRAFÄ°KLERÄ° ===\n")

# SEÃ‡ENEK 1: Grafikleri ayrÄ± ayrÄ± yazdÄ±r (daha bÃ¼yÃ¼k)
cat("1. ACF of Residuals:\n")
print(p_acf)

cat("2. PACF of Residuals:\n") 
print(p_pacf)

cat("3. Q-Q Plot:\n")
print(p_qq)

cat("4. Residuals vs Time:\n")
print(p_res_time)

cat("5. Residuals Histogram:\n")
print(p_res_hist)

# SEÃ‡ENEK 2: Temiz paneller (baÅŸlÄ±ksÄ±z)
# grid.arrange(p_acf, p_pacf, ncol = 2)
# grid.arrange(p_qq, p_res_time, ncol = 2)

# 8.4 Residual Ä°statistikleri
cat("\n=== RESÄ°DUAL Ä°STATÄ°STÄ°KLERÄ° ===\n")
cat("Ortalama:", round(mean(residuals_train), 6), "\n")
cat("Standart Sapma:", round(sd(residuals_train), 4), "\n")
cat("Ã‡arpÄ±klÄ±k (Skewness):", round(e1071::skewness(residuals_train), 4), "\n")
cat("BasÄ±klÄ±k (Kurtosis):", round(e1071::kurtosis(residuals_train), 4), "\n")

# 9. SONUÃ‡ Ã–ZETÄ°
cat("\n", rep("=", 50), "\n")
cat("SONUÃ‡ Ã–ZETÄ°\n")
cat(rep("=", 50), "\n")
cat("Model Tipi:", paste(auto_arima_train$arma[c(1,6,2,3,7,4,5)], collapse=","), "\n")
cat("Train RMSE:", round(train_rmse, 4), "\n")
cat("Test RMSE:", round(test_rmse, 4), "\n")
cat("Model GÃ¼venilirliÄŸi:", 
    ifelse(test_rmse <= train_rmse * 1.2, "YÃ¼ksek ", "DÃ¼ÅŸÃ¼k "), "\n")
cat("Residual Otokorelasyon:", 
    ifelse(ljung_test$p.value > 0.05, "Temiz ", "Problemli "), "\n")
cat("Residual Normallik:", 
    ifelse(shapiro_test$p.value > 0.05, "Normal ", "Normal DeÄŸil "), "\n")

# 10. TAVSÄ°YELER
cat("\nTAVSÄ°YELER:\n")
if(test_rmse > train_rmse * 1.5) {
  cat("- Model Ã§ok karmaÅŸÄ±k, daha basit model deneyin\n")
  cat("- Veri Ã¶n iÅŸleme adÄ±mlarÄ±nÄ± gÃ¶zden geÃ§irin\n")
}
if(ljung_test$p.value <= 0.05) {
  cat("- FarklÄ± ARIMA parametreleri deneyin\n")
  cat("- Mevsimsel diferansiyasyon ekleyin\n")
  cat("- ACF/PACF grafiklerine bakarak eksik lag'leri tespit edin\n")
}
if(shapiro_test$p.value <= 0.05) {
  cat("- Veri transformasyonu (log, Box-Cox) deneyin\n")
  cat("- AykÄ±rÄ± deÄŸerleri kontrol edin\n")
}
if(test_rmse <= train_rmse * 1.1 && ljung_test$p.value > 0.05) {
  cat("- Model Ã§ok baÅŸarÄ±lÄ±! \n")
  cat("- Ãœretim ortamÄ±nda kullanÄ±labilir\n")
}

cat("\n=== ARIMA MODEL VALÄ°DASYONU TAMAMLANDI ===\n")
```

##### Prophet

-   Veri HazÄ±rlama

```{r}
print("\nBLOK 2: GÃ¼nlÃ¼k veri aylÄ±k hale getiriliyor...")

aylik_prophet_veri <- gunluk_analiz %>%
  mutate(
    Yil = year(Tarih),
    Ay = month(Tarih)
  ) %>%
  group_by(Yil, Ay) %>%
  reframe(  
    Tarih = as.Date(paste(Yil, Ay, "01", sep = "-")),
    Ortalama_Anlik = mean(Ortalama_Anlik, na.rm = TRUE)
  ) %>%
  arrange(Tarih) %>%
  filter(!is.na(Ortalama_Anlik))
```

-   Veri KontrolÃ¼ ve Ã–zet

```{r}
print("\nBLOK 3: Veri Ã¶zeti kontrol ediliyor...")

print("AylÄ±k Prophet Verisi Ã–zeti:")
print(paste("Toplam gÃ¶zlem sayÄ±sÄ±:", nrow(aylik_prophet_veri)))
print(paste("Tarih aralÄ±ÄŸÄ±:", min(aylik_prophet_veri$Tarih), "ile", max(aylik_prophet_veri$Tarih)))
print("Ä°lk 6 satÄ±r:")
print(head(aylik_prophet_veri))

print("âœ“ Veri kontrolÃ¼ tamamlandÄ±!")
```

-   Prophet FormatÄ±na Ã‡evirme

```{r}
print("\nBLOK 4: Veri Prophet formatÄ±na Ã§evriliyor...")

prophet_df <- aylik_prophet_veri %>%
  select(Tarih, Ortalama_Anlik) %>%
  rename(ds = Tarih, y = Ortalama_Anlik)

print("âœ“ Prophet formatÄ± hazÄ±rlandÄ± (ds = tarih, y = deÄŸer)")
```

-   Prophet Model KonfigÃ¼rasyonu ve Model EÄŸitimi

```{r}
print("\nBLOK 6: Prophet modeli eÄŸitiliyor...")

prophet_model <- prophet(
  df = prophet_df,
  yearly.seasonality = TRUE,
  weekly.seasonality = FALSE,
  daily.seasonality = FALSE,
  n.changepoints = min(20, floor(nrow(prophet_df) / 4)),
  changepoint.range = 0.8,
  changepoint.prior.scale = 0.05,
  seasonality.prior.scale = 10,
  seasonality.mode = 'additive',
  interval.width = 0.95,
  growth = 'linear'
)

print("âœ“ Prophet modeli baÅŸarÄ±yla eÄŸitildi!")
```

-   Gelecek Tahmin Ã‡erÃ§evesi

```{r}
print("\nBLOK 7: Gelecek tahmin Ã§erÃ§evesi hazÄ±rlanÄ±yor...")

gelecek_aylar <- 24
future_df <- make_future_dataframe(prophet_model, periods = gelecek_aylar, freq = "month")

print(paste("âœ“ Gelecek", gelecek_aylar, "ay iÃ§in tahmin Ã§erÃ§evesi hazÄ±rlandÄ±"))
print(paste("Toplam tahmin dÃ¶nemi:", nrow(future_df), "gÃ¶zlem"))

```

-   Tahmin Yapma

```{r}
print("\nBLOK 8: Prophet tahmini yapÄ±lÄ±yor...")

prophet_forecast <- predict(prophet_model, future_df)

print("âœ“ Prophet tahmini tamamlandÄ±!")
```

-   Ana Grafik OluÅŸturma

```{r}
print("\nBLOK 9: Ana tahmin grafiÄŸi oluÅŸturuluyor...")

png("prophet_forecast_aylik.png", width = 1400, height = 800, res = 100)
plot(prophet_model, prophet_forecast) +
  ggtitle("Prophet AylÄ±k Ortalama AtÄ±k MiktarÄ± Tahmini") +
  xlab("Tarih") +
  ylab("Ortalama AnlÄ±k DeÄŸer") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  )
dev.off()

print("âœ“ Ana grafik 'prophet_forecast_aylik.png' olarak kaydedildi!")

```

-   BileÅŸen Graikleri

```{r}
print("\nBLOK 10: BileÅŸen grafikleri oluÅŸturuluyor...")

png("prophet_components_aylik.png", width = 1400, height = 1000, res = 100)
prophet_plot_components(prophet_model, prophet_forecast)
dev.off()

print("âœ“ BileÅŸen grafikleri 'prophet_components_aylik.png' olarak kaydedildi!")
print("- Trend bileÅŸeni gÃ¶sterildi")
print("- YÄ±llÄ±k mevsimsellik bileÅŸeni gÃ¶sterildi")

```

-   Model Performans Analizi

```{r}
print("\nBLOK 11: Model performansÄ± deÄŸerlendiriliyor...")

# Mevcut veriler iÃ§in tahmin kalitesi
gercek_values <- prophet_df$y
tahmin_values <- prophet_forecast$yhat[1:length(gercek_values)]

# Performans metrikleri
mape <- mean(abs((gercek_values - tahmin_values) / gercek_values), na.rm = TRUE) * 100
rmse <- sqrt(mean((gercek_values - tahmin_values)^2, na.rm = TRUE))
mae <- mean(abs(gercek_values - tahmin_values), na.rm = TRUE)
r_squared <- cor(gercek_values, tahmin_values, use = "complete.obs")^2

print("\n=== PROPHET MODEL PERFORMANSI ===")
print(paste("MAPE (Ortalama Mutlak YÃ¼zde Hata):", round(mape, 2), "%"))
print(paste("RMSE (KÃ¶k Ortalama Kare Hata):", round(rmse, 2)))
print(paste("MAE (Ortalama Mutlak Hata):", round(mae, 2)))
print(paste("RÂ² (AÃ§Ä±klanan Varyans):", round(r_squared, 4)))

print("âœ“ Performans metrikleri hesaplandÄ±!")

```

-   Gelecek Tahminlerini Analiz

```{r}
print("\nBLOK 12: Gelecek dÃ¶nem tahminleri analiz ediliyor...")

gelecek_tahminler <- prophet_forecast %>%
  filter(ds > max(prophet_df$ds)) %>%
  select(ds, yhat, yhat_lower, yhat_upper) %>%
  mutate(
    Yil = year(ds),
    Ay = month(ds),
    Ay_Adi = month.abb[Ay]
  )

print("\n=== GELECEK DÃ–NEM TAHMÄ°NLERÄ° ===")
print(paste("âœ“ Gelecek", nrow(gelecek_tahminler), "ay iÃ§in tahmin yapÄ±ldÄ±"))
print("\nÄ°lk 12 ayÄ±n tahmini:")
print(head(gelecek_tahminler[c("ds", "yhat", "yhat_lower", "yhat_upper")], 12))
```

-   Tahmin Ä°statistikleri

```{r}
print("\nBLOK 13: Tahmin istatistikleri hesaplanÄ±yor...")

print("\n=== TAHMÄ°N Ä°STATÄ°STÄ°KLERÄ° ===")
print(paste("Ortalama tahmin deÄŸeri:", round(mean(gelecek_tahminler$yhat), 2)))
print(paste("Minimum tahmin:", round(min(gelecek_tahminler$yhat), 2)))
print(paste("Maksimum tahmin:", round(max(gelecek_tahminler$yhat), 2)))
print(paste("Standart sapma:", round(sd(gelecek_tahminler$yhat), 2)))

print("âœ“ Genel istatistikler hesaplandÄ±!")
```

-   Mevsimsel Analizler

```{r}
print("\nBLOK 14: Mevsimsel analiz yapÄ±lÄ±yor...")

mevsimsel_ortalama <- gelecek_tahminler %>%
  group_by(Ay, Ay_Adi) %>%
  summarise(
    Ortalama_Tahmin = mean(yhat),
    .groups = "drop"
  ) %>%
  arrange(Ay)

print("\n=== MEVSIMSEL TAHMÄ°N ANALÄ°ZÄ° ===")
print("âœ“ Aylara gÃ¶re ortalama tahmin deÄŸerleri:")
print(mevsimsel_ortalama)
```

-   CROSS-VALIDATION (MODEL DOÄRULAMA)

```{r}
print("\nBLOK 15: Model doÄŸrulama (Cross-Validation) yapÄ±lÄ±yor...")

toplam_gun <- as.numeric(difftime(max(prophet_df$ds), min(prophet_df$ds), units = "days"))

# Otomatik ayarla
initial_gun <- floor(toplam_gun * 0.7)
horizon_gun <- 90

if ((toplam_gun - initial_gun) >= horizon_gun) {
  print("Cross-validation baÅŸlatÄ±lÄ±yor...")
  cv_results <- cross_validation(
    prophet_model,
    initial = initial_gun,
    period = 30,
    horizon = horizon_gun,
    units = 'days'
  )
  cv_metrics <- performance_metrics(cv_results)
  print(cv_metrics)
} else {
  print("âš  Yeterli veri yok: horizon > (toplam veri - initial)")
}


```

```{r}
future <- make_future_dataframe(prophet_model, periods = 180)
forecast <- predict(prophet_model, future)

plot(prophet_model, forecast) +
  ggtitle("Tahmin GrafiÄŸi: Prophet Modeli") +
  xlab("Tarih") + ylab("Tahmin Edilen DeÄŸer")
```

```{r}
prophet_plot_components(prophet_model, forecast)
```

-   SonuÃ§larÄ± Dosyalara Kaydetme

```{r}
print("\nBLOK 16: SonuÃ§lar dosyalara kaydediliyor...")

# CSV dosyalarÄ±
write.csv(prophet_forecast, "prophet_forecast_results.csv", row.names = FALSE)
write.csv(gelecek_tahminler, "prophet_future_predictions.csv", row.names = FALSE)

# Model ve Ã¶zet kaydetme
model_summary <- list(
  model_type = "Prophet",
  data_points = nrow(prophet_df),
  forecast_horizon = gelecek_aylar,
  mape = round(mape, 2),
  rmse = round(rmse, 2),
  mae = round(mae, 2),
  r_squared = round(r_squared, 4)
)

saveRDS(prophet_model, "prophet_model.rds")
saveRDS(model_summary, "prophet_model_summary.rds")

print("âœ“ TÃ¼m sonuÃ§lar baÅŸarÄ±yla kaydedildi!")
```

-   Dosya Ã‡Ä±ktÄ±larÄ± Ã–zeti

```{r}
print("\nBLOK 17: OluÅŸturulan dosyalar listeleniyor...")

print("\n=== OLUÅTURULAN DOSYALAR ===")
print("ğŸ“Š GRAFÄ°K DOSYALARI:")
print("  - prophet_forecast_aylik.png (Ana tahmin grafiÄŸi)")
print("  - prophet_components_aylik.png (BileÅŸen grafikleri)")

print("\nğŸ“‹ VERÄ° DOSYALARI:")
print("  - prophet_forecast_results.csv (TÃ¼m tahmin sonuÃ§larÄ±)")
print("  - prophet_future_predictions.csv (Sadece gelecek tahminler)")

print("\nğŸ”§ MODEL DOSYALARI:")
print("  - prophet_model.rds (EÄŸitilmiÅŸ model)")
print("  - prophet_model_summary.rds (Model Ã¶zeti)")

if (nrow(prophet_df) >= 24) {
  print("\nâœ… DOÄRULAMA DOSYALARI:")
  print("  - prophet_cv_results.csv (Cross-validation sonuÃ§larÄ±)")
  print("  - prophet_cv_metrics.csv (CV performans metrikleri)")
}
```

-   Son
